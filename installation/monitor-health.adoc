---
sidebar: sidebar 
permalink: installation/monitor-health.html 
keywords: monitoring system health 
summary: Para garantir que os dados estejam disponíveis, você pode monitorar a integridade do Keystone Collector usando qualquer sistema de monitoramento que suporte solicitações HTTP. 
---
= Monitore a saúde do Keystone Collector
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Você pode monitorar a saúde do Keystone Collector usando qualquer sistema de monitoramento que suporte solicitações HTTP.  Monitorar a saúde pode ajudar a garantir que os dados estejam disponíveis no painel do Keystone .

Por padrão, os serviços de saúde do Keystone não aceitam conexões de nenhum IP diferente do host local.  O ponto final de saúde da Keystone é `/uber/health` , e escuta em todas as interfaces do servidor Keystone Collector na porta `7777` .  Na consulta, um código de status de solicitação HTTP com uma saída JSON é retornado do ponto de extremidade como uma resposta, descrevendo o status do sistema Keystone Collector.  O corpo JSON fornece um status geral de saúde para o `is_healthy` atributo, que é um booleano; e uma lista detalhada de status por componente para o `component_details` atributo.  Aqui está um exemplo:

[listing]
----
$ curl http://127.0.0.1:7777/uber/health
{"is_healthy": true, "component_details": {"vicmet": "Running", "ks-collector": "Running", "ks-billing": "Running", "chronyd": "Running"}}
----
Esses códigos de status são retornados:

* *200*: indica que todos os componentes monitorados estão saudáveis
* *503*: indica que um ou mais componentes não estão saudáveis
* *403*: indica que o cliente HTTP que consulta o status de integridade não está na lista _allow_, que é uma lista de CIDRs de rede permitidos.  Para esse status, nenhuma informação de saúde é retornada.  A lista _allow_ usa o método CIDR de rede para controlar quais dispositivos de rede têm permissão para consultar o sistema de saúde Keystone .  Se você receber esse erro, adicione seu sistema de monitoramento à lista _permitida_ em * TUI de gerenciamento do Keystone Collector > Configurar > Monitoramento de integridade*.


.Usuários do Linux, observem este problema conhecido:

NOTE: *Descrição do problema*: O Keystone Collector executa vários contêineres como parte do sistema de medição de uso.  Quando o servidor Red Hat Enterprise Linux 8.x é reforçado com as políticas dos Guias de Implementação Técnica de Segurança (STIG) da Agência de Sistemas de Informação de Defesa dos EUA (DISA), um problema conhecido com o fapolicyd (File Access Policy Daemon) tem sido observado intermitentemente.  Este problema é identificado comolink:https://bugzilla.redhat.com/show_bug.cgi?id=1907870["erro 1907870"^] .  *Solução alternativa*: Até que seja resolvido pelo Red Hat Enterprise, a NetApp recomenda que você contorne esse problema colocando `fapolicyd` no modo permissivo.  Em/`etc/fapolicyd/fapolicyd.conf` , defina o valor de `permissive = 1` .



== Ver logs do sistema

Você pode visualizar os logs do sistema do Keystone Collector para revisar informações do sistema e executar a solução de problemas usando esses logs.  O Keystone Collector usa o sistema de registro _journald_ do host, e os registros do sistema podem ser revisados por meio do utilitário de sistema padrão _journalctl_.  Você pode aproveitar os seguintes serviços principais para examinar os logs:

* ks-coletor
* ks-saúde
* ks-atualização automática


O principal serviço de coleta de dados _ks-collector_ produz logs no formato JSON com um `run-id` atributo associado a cada tarefa de coleta de dados agendada.  A seguir, um exemplo de uma tarefa bem-sucedida para coleta de dados de uso padrão:

[listing]
----
{"level":"info","time":"2022-10-31T05:20:01.831Z","caller":"light-collector/main.go:31","msg":"initialising light collector with run-id cdflm0f74cgphgfon8cg","run-id":"cdflm0f74cgphgfon8cg"}
{"level":"info","time":"2022-10-31T05:20:04.624Z","caller":"ontap/service.go:215","msg":"223 volumes collected for cluster a2049dd4-bfcf-11ec-8500-00505695ce60","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:18.821Z","caller":"ontap/service.go:215","msg":"697 volumes collected for cluster 909cbacc-bfcf-11ec-8500-00505695ce60","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:41.598Z","caller":"ontap/service.go:215","msg":"7 volumes collected for cluster f7b9a30c-55dc-11ed-9c88-005056b3d66f","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:48.247Z","caller":"ontap/service.go:215","msg":"24 volumes collected for cluster a9e2dcff-ab21-11ec-8428-00a098ad3ba2","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:48.786Z","caller":"worker/collector.go:75","msg":"4 clusters collected","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:48.839Z","caller":"reception/reception.go:75","msg":"Sending file 65a71542-cb4d-bdb2-e9a7-a826be4fdcb7_1667193648.tar.gz type=ontap to reception","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:48.840Z","caller":"reception/reception.go:76","msg":"File bytes 123425","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"reception/reception.go:99","msg":"uploaded usage file to reception with status 201 Created","run-id":"cdflm0f74cgphgfon8cg"}
----
A seguir, um exemplo de uma tarefa bem-sucedida para coleta opcional de dados de desempenho:

[listing]
----
{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sql/service.go:28","msg":"initialising MySql service at 10.128.114.214"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sql/service.go:55","msg":"Opening MySql db connection at server 10.128.114.214"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sql/service.go:39","msg":"Creating MySql db config object"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sla_reporting/service.go:69","msg":"initialising SLA service"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sla_reporting/service.go:71","msg":"SLA service successfully initialised"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"worker/collector.go:217","msg":"Performance data would be collected for timerange: 2022-10-31T10:24:52~2022-10-31T10:29:52"}

{"level":"info","time":"2022-10-31T05:21:31.385Z","caller":"worker/collector.go:244","msg":"New file generated: 65a71542-cb4d-bdb2-e9a7-a826be4fdcb7_1667193651.tar.gz"}

{"level":"info","time":"2022-10-31T05:21:31.385Z","caller":"reception/reception.go:75","msg":"Sending file 65a71542-cb4d-bdb2-e9a7-a826be4fdcb7_1667193651.tar.gz type=ontap-perf to reception","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:21:31.386Z","caller":"reception/reception.go:76","msg":"File bytes 17767","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:21:33.025Z","caller":"reception/reception.go:99","msg":"uploaded usage file to reception with status 201 Created","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:21:33.025Z","caller":"light-collector/main.go:88","msg":"exiting","run-id":"cdflm0f74cgphgfon8cg"}
----


== Gerar e coletar pacotes de suporte

O TUI do Keystone Collector permite que você gere pacotes de suporte e os adicione a solicitações de serviço para resolver problemas de suporte.  Siga este procedimento:

.Passos
. Inicie o utilitário TUI de gerenciamento do Keystone Collector:
`$ keystone-collector-tui`
. Acesse *Solução de problemas > Gerar pacote de suporte*.image:tui-sup-bundl.png["tela tui"]
. Quando gerado, o local onde o pacote é salvo é exibido.  Use FTP, SFTP ou SCP para se conectar ao local e baixar o arquivo de log para um sistema local.image:tui-sup-bundl-2.png["tela tui"]
. Quando o arquivo for baixado, você pode anexá-lo ao tíquete de suporte do Keystone ServiceNow.  Para obter informações sobre como levantar bilhetes, consultelink:../concepts/gssc.html["Gerando solicitações de serviço"] .

